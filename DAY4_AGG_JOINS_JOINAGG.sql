USE ECOMMERCE_PLATFORM;

CREATE TABLE ORD_CUST_DETAILS (     -- CREATING 2 TABLES FOR JOINS
TNXID INT PRIMARY KEY,    
CUST_EMAIL VARCHAR(255),
CUST_ADDRESS VARCHAR(255),
CUST_CITY VARCHAR(255),
);

INSERT INTO ORD_CUST_DETAILS       -- CUSTOMER DETAILS
VALUES                  
(1001,'ABC@GMAIL.COM','ACC HOUSE','BOM'), 
(1003,'A12@YAHOO.COM','CV NAGAR','AHMD'),
(1004,'XYZ@HOTMAIL.COM','ST PAULS ROAD','IXC'),
(1002,'qwe@gmail.com','Kalyan nagar','BOM'),
(1005,'rty@yahoo.com','BTM','CHN'),
(2011,'kkr@gmail.com','bly nest','CCU'),
(1007,'FCB@YAHOO.COM','BEL RD','CCU'),
(2008,'RMA@zoho.com','xz area','DEL'),
(1009,'ram@rediffmail.com','abc zone','GWT')
;

CREATE TABLE LOC_DETAILS (     
LOC_NAME CHAR(50) PRIMARY KEY,    
REGION CHAR(50)
);

INSERT INTO LOC_DETAILS      -- LOCATION DETAILS
VALUES
('BOM','WEST'),
('KOC','SOUTH'),
('CHN','SOUTH'),
('BBU','EAST'),
('CCU','EAST'),
('GWT','EAST'),
('DEL','NORTH'),
('IXC','NORTH'),
('AHMD','WEST')
;

SELECT * FROM  ORD_CUST_DETAILS;
SELECT * FROM LOC_DETAILS;
select * from TRANSAC_PRC_CLASS;

--------
--------

SELECT T.*                  -- ALL COLUMNS FROM TRANSAC_PRC_CLASS WILL COME
		, O.*                   -- ALL COLUMNS FROM ORD_CUST_DETAILS WILL COME
		FROM TRANSAC_PRC_CLASS as T
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID;   -- JOINING CONDITION -- HOW AND ON WHAT WE WANT TO JOIN THE TABLES 



SELECT TRANS.TNXID, TRANS.PRODUCTID, TRANS.PRICE  -- PULLING SPECIFIC INFO FROM TRANSAC_PRC_CLASS
		, OD.CUST_EMAIL  -- PULLING SPECIFIC INFO FROM ORD_CUST_DETAILS

		FROM TRANSAC_PRC_CLASS TRANS
		LEFT JOIN    -- ALL INFORMATION FROM LEFT TABLE + THE MATCHING VALUES FORM THE RIGHT TABLE WILL COME ON WHICH WE ARE JOINING ALONG WITH THE SPEFICIC COLUMNS THAT WE ARE PULLING FROM THE LEFT TABLE -- LEFT TABLE WILL GET PRIORITY -- VALUES WHICH ARENT MATCHING WILL BE POPULATED WILL NULL
		ORD_CUST_DETAILS AS OD

		ON TRANS.TNXID=OD.TNXID;

SELECT * FROM  ORD_CUST_DETAILS;



SELECT O.*,
		T.*
		FROM TRANSAC_PRC_CLASS AS T
		RIGHT JOIN   -- JUST THE INVERSE OF LEFT JOIN 
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID;



SELECT O.*,
		T.*
		FROM TRANSAC_PRC_CLASS AS T
		INNER JOIN   -- COMMON VALUES THAT ARE MATCHING IN BOTH THE TABLES WILL COME AS OUTPUT
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID;



SELECT O.*,
		T.*
		FROM TRANSAC_PRC_CLASS AS T
		FULL OUTER JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID;

SELECT * FROM LOC_DETAILS;
SELECT * FROM ORD_CUST_DETAILS;


SELECT T.*    -- ALL COLUMNS FORM T
		, O.*   -- ALL COLUMNS FROM O
		, L.*  -- ALL COLUMNS FROM L
		FROM TRANSAC_PRC_CLASS AS T   -- JOINING MULTIPLE TABLES ON THE RELEVANT COLUMNS 
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID
		
		LEFT JOIN
		LOC_DETAILS L
		ON L.LOC_NAME=O.CUST_CITY;


select t.tnxid, t.productid, t.price   -- PULLING IN ONLY SPECIFIC INFO FROM THE MULTIPLE TABLES 
		, o.cust_city
		,l.region
		from TRANSAC_PRC_CLASS as t
		left join 
		ORD_CUST_DETAILS AS O
		on T.TNXID=O.TNXID

		left join
		LOC_DETAILS as l
		on L.LOC_NAME=O.CUST_CITY;


SELECT T.TNXID
		, T.PRODUCTID
		, T.PRICE
		, T.PRODUCT_CLASS
		, O.CUST_CITY
		, L.REGION

		FROM TRANSAC_PRC_CLASS AS T
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID
		
		LEFT JOIN
		LOC_DETAILS L
		ON L.LOC_NAME=O.CUST_CITY; 


SELECT T.*, O.* 
	FROM TRANSAC_PRC_CLASS AS T
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID;


-- Calc. total revenue generated from each city
SELECT O.CUST_CITY   -- PULLING FROM O TABLE
		, SUM(T.PRICE) REVENUE_GENERATED  -- AGGREGATING ON PRICE COLUMN WHICH WE GOT AFTER JOINING BOTH THE TABLES
		FROM TRANSAC_PRC_CLASS AS T        -- JOIN THE 2 TABLES TO GET THE PRICE AND LOC INFO. 
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID
		GROUP BY O.CUST_CITY; 


-- Calc. total revenue generated by PRODUCT CLASS from each city
SELECT T.PRODUCT_CLASS
		, O.CUST_CITY
		, SUM(T.PRICE) REVENUE_GENERATED
		, AVG(T.DISC_PEC) AS TOTAL_DISC_GIVEN
		FROM TRANSAC_PRC_CLASS AS T
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID
		GROUP BY
		T.PRODUCT_CLASS
		, O.CUST_CITY
		ORDER BY 
		T.PRODUCT_CLASS;


-- 
SELECT T.PRODUCT_CLASS
		, L.REGION
		, AVG(T.PRICE) REVENUE_GENERATED

		FROM TRANSAC_PRC_CLASS AS T

		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID

		LEFT JOIN
		LOC_DETAILS L
		ON L.LOC_NAME=O.CUST_CITY

		GROUP BY
		T.PRODUCT_CLASS
		, L.REGION
		ORDER BY 
		PRODUCT_CLASS,
		REGION DESC;
