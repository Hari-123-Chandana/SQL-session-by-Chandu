
SELECT * FROM TRANSAC ORDER BY PRICE, DISC_PEC;
SELECT * FROM TRANSAC ORDER BY PRICE DESC, DISC_PEC;



SELECT DISTINCT PRODUCTID FROM TRANSAC;

INSERT INTO TRANSAC       --FILL IN INFORMATION INTO THE TABLE CREATED (HERE ITS TRANSACION TABLE)
VALUES                  -- ALL VALUES SHOULD BE STORED IN ORDER OF THE COLUMN NAMES
(1010,'P1','TSHIRT',NULL,NULL)
;

SELECT * FROM TRANSAC;
SELECT * FROM TRANSAC WHERE PRICE IS NOT NULL;
SELECT *, ISNULL(PRICE,50) AS UPDT_PRC FROM TRANSAC;
SELECT *, COALESCE(PRICE,100) AS UPDT_PRC2 FROM TRANSAC;


-- Bucket the products as per price ranges as high, medium and low 

CREATE VIEW TRANSAC_PRC AS 
SELECT *
	, CASE
	WHEN PRICE>100 THEN 'HIGH'
	WHEN PRICE>50 AND PRICE<100 THEN 'MEDIUM'
	ELSE 'LOW'
	END AS PRICE_CLASS
	FROM TRANSAC ;

DROP VIEW TRANSAC_PRC_CLASS;
-- Make product categories and classify the items
CREATE VIEW TRANSAC_PRC_CLASS AS
SELECT *
		, CASE 
		WHEN PRODUCTDESC IN ('TSHIRT','SHIRT') THEN 'MENS WEAR'
		WHEN PRODUCTDESC IN ('SAREE','TOP') THEN 'WOMEN WEAR'
		WHEN PRODUCTDESC IN ('PANT') THEN 'UNISEX'
		ELSE 'UNK'
		END AS PRODUCT_CLASS
		FROM TRANSAC_PRC;


-- Want to see how many products has price >100
SELECT COUNT(*) FROM TRANSAC_PRC_CLASS WHERE PRICE>100;

-- Want to see total number of products sold as per product description 
SELECT PRODUCTDESC
		, COUNT(PRODUCTID) AS NUM_OF_PRODS 
			FROM TRANSAC 
	   GROUP BY PRODUCTDESC;

-- Want to see the no. of distinct products sold under every product description
SELECT PRODUCTDESC
		, COUNT(DISTINCT PRODUCTID) AS NUM_OF_PRODS 
			FROM TRANSAC 
		GROUP BY PRODUCTDESC;


SELECT PRODUCTDESC
		, COUNT(PRODUCTID) AS NUM_OF_PRODS 
			FROM TRANSAC 
		GROUP BY PRODUCTDESC 
		HAVING COUNT(PRODUCTID)>3;

SELECT * FROM TRANSAC;

SELECT * FROM TRANSAC_PRC_CLASS;

-- How much revenue did we generate from every product 
SELECT PRODUCTID
		, SUM(PRICE) AS TOTAL_REVENUE
		FROM TRANSAC_PRC_CLASS
		GROUP BY PRODUCTID;


-- How much AVERAGE revenue did we generate from every product class
SELECT PRODUCT_CLASS
		, AVG(PRICE) AS MEAN_REVENUE_GENERATED
		FROM TRANSAC_PRC_CLASS
		GROUP BY PRODUCT_CLASS;

SELECT PRODUCTID
		, MAX(DISC_PEC) AS MAX_DISCOUNT_GIVEN
		FROM TRANSAC_PRC_CLASS
		GROUP BY PRODUCTID;

SELECT * FROM TRANSAC_PRC_CLASS;

SELECT PRODUCT_CLASS
		, PRODUCTDESC
		, SUM(PRICE) AS TOTAL_REVENUE
		FROM TRANSAC_PRC_CLASS
		GROUP BY PRODUCT_CLASS,
		PRODUCTDESC
		ORDER BY PRODUCT_CLASS
		,PRODUCTDESC;

--------------------------------------------------------------------------
USE ECOMMERCE_PLATFORM;

CREATE TABLE ORD_CUST_DETAILS (     
TNXID INT PRIMARY KEY,    
CUST_EMAIL VARCHAR(255),
CUST_ADDRESS VARCHAR(255),
CUST_CITY VARCHAR(255),
);

INSERT INTO ORD_CUST_DETAILS       
VALUES                  
(1001,'ABC@GMAIL.COM','ACC HOUSE','BOM'), 
(1003,'A12@YAHOO.COM','CV NAGAR','AHMD'),
(1004,'XYZ@HOTMAIL.COM','ST PAULS ROAD','IXC'),
(1002,'qwe@gmail.com','Kalyan nagar','BOM'),
(1005,'rty@yahoo.com','BTM','CHN'),
(2011,'kkr@gmail.com','bly nest','CCU'),
(1007,'FCB@YAHOO.COM','BEL RD','CCU'),
(2008,'RMA@zoho.com','xz area','DEL'),
(1009,'ram@rediffmail.com','abc zone','GWT')
;

CREATE TABLE LOC_DETAILS (     
LOC_NAME CHAR(50) PRIMARY KEY,    
REGION CHAR(50)
);

INSERT INTO LOC_DETAILS
VALUES
('BOM','WEST'),
('KOC','SOUTH'),
('CHN','SOUTH'),
('BBU','EAST'),
('CCU','EAST'),
('GWT','EAST'),
('DEL','NORTH'),
('IXC','NORTH'),
('AHMD','WEST')
;

SELECT * FROM  ORD_CUST_DETAILS;
SELECT * FROM LOC_DETAILS;

--------

SELECT T.*
		, O.*
		FROM TRANSAC_PRC_CLASS AS T
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID;

--SELECT * FROM  ORD_CUST_DETAILS;

SELECT O.*,
		T.*
		FROM TRANSAC_PRC_CLASS AS T
		RIGHT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID;

SELECT O.*,
		T.*
		FROM TRANSAC_PRC_CLASS AS T
		INNER JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID;

SELECT O.*,
		T.*
		FROM TRANSAC_PRC_CLASS AS T
		FULL OUTER JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID;

SELECT T.*
		, O.*
		, L.*
		FROM TRANSAC_PRC_CLASS AS T
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID
		
		LEFT JOIN
		LOC_DETAILS L
		ON L.LOC_NAME=O.CUST_CITY;



SELECT T.TNXID
		, T.PRODUCTID
		, T.PRICE
		, T.PRODUCT_CLASS
		, O.CUST_CITY
		, L.REGION

		FROM TRANSAC_PRC_CLASS AS T
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID
		
		LEFT JOIN
		LOC_DETAILS L
		ON L.LOC_NAME=O.CUST_CITY; 

-- Calc. total revenue generated from each city
SELECT O.CUST_CITY
		, SUM(T.PRICE) REVENUE_GENERATED
		FROM TRANSAC_PRC_CLASS AS T
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID
		GROUP BY O.CUST_CITY; 

		
-- Calc. total revenue generated by PRODUCT CLASS from each city
SELECT T.PRODUCT_CLASS
		, O.CUST_CITY
		, SUM(T.PRICE) REVENUE_GENERATED
		FROM TRANSAC_PRC_CLASS AS T
		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID
		GROUP BY
		T.PRODUCT_CLASS
		, O.CUST_CITY
		ORDER BY 
		T.PRODUCT_CLASS;

-- 
SELECT T.PRODUCT_CLASS
		, L.REGION
		, AVG(T.PRICE) REVENUE_GENERATED

		FROM TRANSAC_PRC_CLASS AS T

		LEFT JOIN
		ORD_CUST_DETAILS AS O
		ON 
		T.TNXID=O.TNXID

		LEFT JOIN
		LOC_DETAILS L
		ON L.LOC_NAME=O.CUST_CITY

		GROUP BY
		T.PRODUCT_CLASS
		, L.REGION
		ORDER BY 
		PRODUCT_CLASS,
		REGION DESC;

--USE ECOMMERCE_PLATFORM;

-- Calc. contribution of sales for each product class
SELECT PRODUCT_CLASS
		, CONCAT(ROUND((SUM(PRICE)/ (SELECT SUM(PRICE) FROM TRANSAC_PRC_CLASS))*100,2),'%') AS REVENUE_CONTRI
		FROM TRANSAC_PRC_CLASS
		GROUP BY PRODUCT_CLASS;
